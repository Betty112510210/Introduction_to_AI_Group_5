# -*- coding: utf-8 -*-
"""chatgpt_label

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1dGhlybmlhhw0l8UOtXhgYU2spVBdSHwp
"""

pip install --upgrade openai

import pandas as pd
import openai
import random
import time

from google.colab import drive
drive.mount('/content/drive')

"""éš¨æ©ŸæŠ½100ç­†"""

input_path = "/content/drive/MyDrive/original_data/@entertain_data.csv"
df = pd.read_csv(input_path, encoding='utf-8')

sample_df = df.sample(n=100, random_state=42).reset_index(drop=True)

output_path = "/content/drive/MyDrive/sample_100.csv"
sample_df.to_csv(output_path, index=False, encoding='utf-8-sig')

print(f"âœ… éš¨æ©ŸæŠ½å–100ç­†å·²å­˜åˆ°ï¼š{output_path}")

"""ä»‡æ¨æ¨™è¨»ã€å¼•å°å¼æ€è€ƒ"""

import pandas as pd
from tqdm import tqdm
import time
from openai import OpenAI

client = OpenAI(api_key="your_api_key")

def analyze_sentiment(comment):
    prompt = f"""
ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„ç¶²è·¯è©•è«–åˆ†æå¸«ï¼Œç†Ÿæ‚‰ YouTube ç•™è¨€èˆ‡ç¶²è·¯ç”¨èªã€‚

ä»‡æ¨è¨€è«–ï¼ˆHate speechï¼‰çš„å®šç¾©å¦‚ä¸‹ï¼š
ä»‡æ¨è¨€è«–æ˜¯æŒ‡æ”»æ“Šã€è²¶ä½ã€æ­§è¦–æˆ–ç…½å‹•å°ç‰¹å®šå€‹äººæˆ–ç¾¤é«”çš„æ•µæ„è¨€è«–ï¼Œç‰¹åˆ¥æ˜¯é‡å°å…¶ç¨®æ—ã€æ€§åˆ¥ã€å®—æ•™ã€æ€§å–å‘ã€èº«å¿ƒéšœç¤™ã€åœ‹ç±ç­‰èº«ä»½ã€‚é€™äº›è¨€è«–å¯èƒ½å¸¶æœ‰äººèº«æ”»æ“Šã€æ¿€èµ·ä»‡æ¨ã€ç…½å‹•æš´åŠ›æˆ–ç¤¾æœƒå°ç«‹ï¼Œä¸¦å¯èƒ½å¼•ç™¼é–±è®€è€…çš„è² é¢æƒ…ç·’æˆ–ç¤¾æœƒå½±éŸ¿ã€‚

è«‹ä½ æ ¹æ“šé€™å€‹å®šç¾©ï¼Œåˆ¤æ–·ä¸‹åˆ—ç•™è¨€æ˜¯å¦å±¬æ–¼ä»‡æ¨è¨€è«–ã€‚
è«‹åªå›ç­”ã€Œæœƒã€æˆ–ã€Œä¸æœƒã€ï¼Œä¸è¦è£œå……ä»»ä½•èªªæ˜æˆ–ç†ç”±ã€‚

ç•™è¨€ï¼š
{comment}

é€™æ˜¯ä»‡æ¨è¨€è«–å—ï¼Ÿ
"""

    response = client.chat.completions.create(
        model="gpt-4o",
        messages=[{"role": "user", "content": prompt}],
        temperature=0,
        max_tokens=10
    )
    label = response.choices[0].message.content.strip()

    if label in ['æœƒ', 'ä¸æœƒ']:
        return label
    elif label.startswith("ä¸"):
        return "ä¸æœƒ"
    elif label.startswith("æœƒ"):
        return "æœƒ"
    else:
        raise ValueError(f"å›è¦†æ¨™ç±¤ä¸æ­£ç¢º: {label}")

def process_file(input_path, output_path):
    df = pd.read_csv(input_path, encoding='utf-8')
    df['label'] = None

    for i, comment in enumerate(tqdm(df['Comment'], desc="åˆ†æç•™è¨€æ˜¯å¦ç‚ºä»‡æ¨è¨€è«–")):
        try:
            label = analyze_sentiment(comment)
        except Exception as e:
            print(f"âŒ ç¬¬{i}ç­†ç•™è¨€ç™¼ç”ŸéŒ¯èª¤ï¼š{e}")
            label = "error"
        df.at[i, 'label'] = label
        time.sleep(1)  # æ§åˆ¶é€Ÿç‡ï¼Œé¿å… API é™åˆ¶

    df.to_csv(output_path, index=False, encoding='utf-8-sig')
    print(f"âœ… åˆ†æå®Œæˆä¸¦å„²å­˜çµæœè‡³ï¼š{output_path}")

# å‘¼å«ç¯„ä¾‹
input_path = "/content/drive/MyDrive/negative_sample.csv"
output_path = "/content/drive/MyDrive/negative_sample_bully.csv"
process_file(input_path, output_path)

"""ä»‡æ¨æ¨™è¨»ï¼Œç„¡èªå¢ƒ"""

import pandas as pd
from tqdm import tqdm
import time
from openai import OpenAI

client = OpenAI(api_key="your_api_key")

def analyze_sentiment(comment):
    prompt = f"""
ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„ç¶²è·¯è©•è«–åˆ†æå¸«ï¼Œè«‹åƒè€ƒ YouTube ç•™è¨€èˆ‡ç¶²è·¯æµè¡Œç”¨å­—ï¼Œ
ä½ æ˜¯å°ˆæ¥­çš„ç¶²è·¯è©•è«–åˆ†æå¸«ï¼Œ
åˆ¤æ–·ä»¥ä¸‹ç•™è¨€æ˜¯å¦å¯èƒ½é€ æˆä»‡æ¨è¨€è«–ï¼ˆHate speechï¼‰ï¼Œ
åªå›è¦†ä¸€å€‹è©ï¼šæœƒã€ä¸æœƒã€‚
ç•™è¨€ï¼š{comment}
"""

    response = client.chat.completions.create(
        model="gpt-4o",
        messages=[{"role": "user", "content": prompt}],
        temperature=0,
        max_tokens=10
    )
    label = response.choices[0].message.content.strip()

    if label in ['æœƒ', 'ä¸æœƒ']:
        return label
    elif label.startswith("ä¸"):
        return "ä¸æœƒ"
    elif label.startswith("æœƒ"):
        return "æœƒ"
    else:
        raise ValueError(f"å›è¦†æ¨™ç±¤ä¸æ­£ç¢º: {label}")

def process_file(input_path, output_path):
    df = pd.read_csv(input_path, encoding='utf-8')
    df['label'] = None

    for i, comment in enumerate(tqdm(df['Comment'], desc="åˆ†æç•™è¨€æ˜¯å¦ç‚ºä»‡æ¨è¨€è«–")):
        try:
            label = analyze_sentiment(comment)
        except Exception as e:
            print(f"âŒ ç¬¬{i}ç­†ç•™è¨€ç™¼ç”ŸéŒ¯èª¤ï¼š{e}")
            label = "error"
        df.at[i, 'label'] = label
        time.sleep(1)  # æ§åˆ¶é€Ÿç‡ï¼Œé¿å… API é™åˆ¶

    df.to_csv(output_path, index=False, encoding='utf-8-sig')
    print(f"âœ… åˆ†æå®Œæˆä¸¦å„²å­˜çµæœè‡³ï¼š{output_path}")

# å‘¼å«ç¯„ä¾‹
input_path = "/content/drive/MyDrive/negative_sample.csv"
output_path = "/content/drive/MyDrive/negative_sample_bully.csv"
process_file(input_path, output_path)

"""éœ¸å‡Œæ¨™è¨»ï¼Œå¼•å°å¼æ€è€ƒ"""

import pandas as pd
from tqdm import tqdm
import time
from openai import OpenAI

client = OpenAI(api_key="your_api_key")

def analyze_cyberbullying(comment):
    prompt = f"""
ä½ æ˜¯ä¸€ä½ç†Ÿæ‚‰ç¤¾ç¾¤åª’é«”èˆ‡ç¶²è·¯æ–‡åŒ–çš„è©•è«–åˆ†æå¸«ã€‚

ç¶²è·¯éœ¸å‡Œæ˜¯æŒ‡é€éæ–‡å­—ã€èªæ°£ã€è¡¨æƒ…ã€è«·åˆºç­‰å½¢å¼ï¼Œåœ¨ç¶²è·¯ä¸Šæ”»æ“Šã€ç¾è¾±ã€è²¶ä½ã€å­¤ç«‹ã€æ’æ“ æˆ–å˜²ç¬‘æŸäººã€‚é€™äº›è¨€è«–å¯èƒ½ä¸æ˜¯ç›´æ¥ç½µäººï¼Œå»ä»é€ æˆä»–äººæƒ…ç·’å‚·å®³ã€å¼•ç™¼å°ç‰¹å®šå€‹äººçš„æ•µæ„æˆ–ç¾¤é«”æ’æ“ ã€‚

- å†·å˜²ç†±è«·æˆ–èªå¸¶æ”»æ“Šï¼ˆä¾‹å¦‚ï¼šã€Œå¥½æ£’æ£’å–”ã€ã€ŒçœŸæœ‰ä½ çš„ï¼Œå‡ºä¾†ä¸Ÿè‡‰ã€ï¼‰
- è²¶ä½å¤–è²Œã€æ™ºå•†ã€è¡Œç‚ºï¼ˆä¾‹å¦‚ï¼šã€Œçœ‹ä»–é‚£å¾·è¡Œå°±çŸ¥é“äº†ã€ã€Œè…¦è¢‹æœ‰å•é¡Œå§ã€ï¼‰
- ä¾®è¾±ã€æ”»æ“Šã€ç¾¤å˜²ï¼ˆä¾‹å¦‚ï¼šã€Œä»–é€™ç¨®äººæ´»è©²è¢«ç½µã€ã€Œå¤§å®¶éƒ½çŸ¥é“ä»–å¾ˆçˆ›ã€ï¼‰
- ç”¨ç¬‘è©±æˆ–å˜²è«·èªæ°£æ©é£¾æ”»æ“Šæ„åœ–

è«‹æ ¹æ“šä¸Šè¿°å®šç¾©ï¼Œåˆ¤æ–·ä»¥ä¸‹ç•™è¨€æ˜¯å¦å±¬æ–¼ç¶²è·¯éœ¸å‡Œã€‚
è«‹åªå›ç­”ã€Œæœƒã€æˆ–ã€Œä¸æœƒã€ï¼Œä¸è¦è£œå……ç†ç”±æˆ–å…¶ä»–æ–‡å­—ã€‚

ç•™è¨€ï¼š
{comment}

é€™æ˜¯ç¶²è·¯éœ¸å‡Œå—ï¼Ÿ
"""

    response = client.chat.completions.create(
        model="gpt-4o",
        messages=[{"role": "user", "content": prompt}],
        temperature=0,
        max_tokens=10
    )
    label = response.choices[0].message.content.strip()

    if label in ['æœƒ', 'ä¸æœƒ']:
        return label
    elif label.startswith("ä¸"):
        return "ä¸æœƒ"
    elif label.startswith("æœƒ"):
        return "æœƒ"
    else:
        raise ValueError(f"å›è¦†æ¨™ç±¤ä¸æ­£ç¢º: {label}")

def process_file(input_path, output_path):
    df = pd.read_csv(input_path, encoding='utf-8')
    df['label'] = None

    for i, comment in enumerate(tqdm(df['Comment'], desc="åˆ†æç•™è¨€æ˜¯å¦ç‚ºç¶²è·¯éœ¸å‡Œ")):
        try:
            label = analyze_cyberbullying(comment)
        except Exception as e:
            print(f"âŒ ç¬¬{i}ç­†ç•™è¨€ç™¼ç”ŸéŒ¯èª¤ï¼š{e}")
            label = "error"
        df.at[i, 'label'] = label
        time.sleep(1)  # æ§åˆ¶é€Ÿç‡ï¼Œé¿å… API é™åˆ¶

    df.to_csv(output_path, index=False, encoding='utf-8-sig')
    print(f"âœ… åˆ†æå®Œæˆä¸¦å„²å­˜çµæœè‡³ï¼š{output_path}")

# å‘¼å«ç¯„ä¾‹
input_path = "/content/drive/MyDrive/negative_sample.csv"
output_path = "/content/drive/MyDrive/negative_sample_bully.csv"
process_file(input_path, output_path)

import pandas as pd
from tqdm import tqdm
import time
from openai import OpenAI

client = OpenAI(api_key="your_api_key")

def analyze_cyberbullying(comment):
    prompt = f"""
ä½ æ˜¯ä¸€ä½ç†Ÿæ‚‰ç¤¾ç¾¤åª’é«”èˆ‡ç¶²è·¯æ–‡åŒ–çš„è©•è«–åˆ†æå¸«ã€‚

è«‹åƒè€ƒ YouTube ç•™è¨€èˆ‡ç¶²è·¯ç”¨èªï¼Œä½ æ˜¯å°ˆæ¥­çš„ç¶²è·¯è©•è«–åˆ†æå¸«ï¼Œåˆ¤æ–·ä»¥ä¸‹ç•™è¨€æ˜¯å¦å¯èƒ½æ§‹æˆç¶²è·¯éœ¸å‡Œï¼ˆCyberbullyingï¼‰ï¼Œä¾‹å¦‚å†·å˜²ç†±è«·ã€ç¾¤é«”æ”»æ“Šã€ç¾è¾±æˆ–é€ æˆæƒ…ç·’å‚·å®³ã€‚åªå›è¦†ä¸€å€‹è©ï¼šã€Œæœƒã€æˆ–ã€Œä¸æœƒã€ã€‚
ç•™è¨€ï¼š{comment}
"""

    response = client.chat.completions.create(
        model="gpt-4o",
        messages=[{"role": "user", "content": prompt}],
        temperature=0,
        max_tokens=10
    )
    label = response.choices[0].message.content.strip()

    if label in ['æœƒ', 'ä¸æœƒ']:
        return label
    elif label.startswith("ä¸"):
        return "ä¸æœƒ"
    elif label.startswith("æœƒ"):
        return "æœƒ"
    else:
        raise ValueError(f"å›è¦†æ¨™ç±¤ä¸æ­£ç¢º: {label}")

def process_file(input_path, output_path):
    df = pd.read_csv(input_path, encoding='utf-8')
    df['label'] = None

    for i, comment in enumerate(tqdm(df['Comment'], desc="åˆ†æç•™è¨€æ˜¯å¦ç‚ºç¶²è·¯éœ¸å‡Œ")):
        try:
            label = analyze_cyberbullying(comment)
        except Exception as e:
            print(f"âŒ ç¬¬{i}ç­†ç•™è¨€ç™¼ç”ŸéŒ¯èª¤ï¼š{e}")
            label = "error"
        df.at[i, 'label'] = label
        time.sleep(1)  # æ§åˆ¶é€Ÿç‡ï¼Œé¿å… API é™åˆ¶

    df.to_csv(output_path, index=False, encoding='utf-8-sig')
    print(f"âœ… åˆ†æå®Œæˆä¸¦å„²å­˜çµæœè‡³ï¼š{output_path}")

# å‘¼å«ç¯„ä¾‹
input_path = "/content/drive/MyDrive/negative_sample.csv"
output_path = "/content/drive/MyDrive/negative_sample_bully.csv"
process_file(input_path, output_path)

"""æƒ…ç·’æ¨™è¨»"""

import pandas as pd
from tqdm import tqdm
import time
from openai import OpenAI

client = OpenAI(api_key="your_api_key")

def analyze_sentiment(comment):
    prompt = f"""è«‹åƒè€ƒyoutubeç•™è¨€èˆ‡ç¶²è·¯æµè¡Œç”¨å­—ï¼Œä½ æ˜¯å°ˆæ¥­çš„ç¶²è·¯è©•è«–åˆ†æå¸«ï¼Œåˆ¤æ–·ä»¥ä¸‹ç•™è¨€çš„æƒ…ç·’ï¼Œåªå›è¦†ä¸€å€‹è©ï¼špositiveã€neutral æˆ– negativeã€‚
    ç•™è¨€ï¼š{comment}"""
    response = client.chat.completions.create(
        model="gpt-4o",
        messages=[{"role": "user", "content": prompt}],
        temperature=0,
        max_tokens=1
    )
    label = response.choices[0].message.content.strip().lower()
    if label not in ['positive', 'neutral', 'negative']:
        raise ValueError(f"å›è¦†æ¨™ç±¤ä¸æ­£ç¢º: {label}")
    return label

def process_file(input_path, output_path):
    df = pd.read_csv(input_path, encoding='utf-8')
    df['label'] = None

    for i, comment in enumerate(tqdm(df['Comment'], desc="åˆ†ææƒ…ç·’")):
        try:
            label = analyze_sentiment(comment)
        except Exception as e:
            print(f"âŒ ç¬¬{i}ç­†ç•™è¨€ç™¼ç”ŸéŒ¯èª¤ï¼š{e}")
            label = "error"
        df.at[i, 'label'] = label
        time.sleep(1)  # æ§åˆ¶å‘¼å«é€Ÿç‡

    df.to_csv(output_path, index=False, encoding='utf-8-sig')
    print(f"âœ… å®Œæˆå„²å­˜ï¼š{output_path}")

# å‘¼å«ç¯„ä¾‹
input_path = "/content/drive/MyDrive/original_data/@news_data.csv"
output_path = "/content/drive/MyDrive/label_data/@news_data_label.csv"
process_file(input_path, output_path)

"""æ¯”å°ç‡"""

# è®€å– CSV æª”æ¡ˆ
input_path = "/çµ±è¨ˆæ¯”å°ç‡ - sample_100 (1).csv"
df = pd.read_csv(input_path, encoding='utf-8')  # æ›¿æ›ç‚ºä½ çš„æª”æ¡ˆåç¨±

# æ¯”å°å…©æ¬„æ˜¯å¦ç›¸åŒ
match_series = df['my_label'] == df['label-4o']

# è¨ˆç®—ç›¸åŒç­†æ•¸èˆ‡æ¯”ç‡
same_count = match_series.sum()
total_count = len(df)
ratio = same_count / total_count

# é¡¯ç¤ºçµæœ
print(f"âœ… ç›¸åŒç­†æ•¸ï¼š{same_count}/{total_count}")
print(f"ğŸ“Š ç›¸åŒæ¯”ç‡ï¼š{ratio:.2%}")